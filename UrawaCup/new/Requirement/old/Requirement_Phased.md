# UrawaCup System: Phased Requirements Definition (Re-evaluated)

## 1. 問い直すべき前提 (Re-evaluating Premises)

原点の要件定義 (`requirement.md`) に対して、開発コストと現場の運用負荷の観点から前提を再考する。

| 元の前提 | 問い直し (Insight) | 結論 (Decision) |
|:---|:---|:---|
| **「完全自動化こそ正義」** | 年1回の大会で複雑な自動日程生成アルゴリズムはコスパが悪い。現場に必要なのは「自動作成」よりも「入力ミスの検知」ではないか？ | **MINI/MIDDLEは「検知・補助」に留め、MAXで「自動化」を目指す**。まずは手動入力をシステムがサポートする形をとる。 |
| **「全員が同時に使う」** | 最初から全会場スタッフにアカウント配り、教育するのはリスクが高い。まずは「本部集中入力」でもExcelよりは遥かにマシではないか？ | **MINIは「本部管理ツール」** として定義。**MIDDLEで「分散入力」** へ拡張する。 |
| **「アプリが必要」** | インストールハードルが高い。スタッツ入力用の専用アプリまでは不要で、モダンなWebアプリ（PWA）で十分ではないか？ | **PWA (Webアプリ)** で統一。インストール不要でオフライン機能を実現する (MAXフェーズ)。 |
| **「リアルタイム」の意味** | 秒単位の同期が必要か？「試合終了→即座に順位表反映」で十分ではないか？ | **更新頻度は「試合完了時」** とする。ストリーミング配信のようなリアルタイム性はMAX要件とする。 |

---

## 2. Phased Definitions

### Phase 1: MINI - The "Reliable Core" (信頼できる計算機)
**コンセプト**: 脱・Excel関数地獄。データの整合性を担保する。
**ターゲット**: 本部担当者（1〜2名）

#### 機能要件 (Must Have)
1.  **チーム・グループ管理**: 24チームの登録とグループ分けの保持。
2.  **試合結果入力 (管理者のみ)**: 固定された日程に対するスコア入力。
3.  **順位表の完全自動計算**:
    *   勝点、得失点、総得点、対戦成績（H2H）のロジック実装。
    *   **Excel最大の苦痛ポイント（順位計算ミス）をゼロにする。**
4.  **基礎エクスポート**: マスコミ送付用ではないが、データ確認用のCSV/Excel出力。

#### 非機能要件
*   **UI**: PCブラウザメイン（管理者がPCで入力）。
*   **Auth**: Basic認証レベル（または共有パスワード）。

---

### Phase 2: MIDDLE - The "Efficient Manager" (業務効率化ツール)
**コンセプト**: 報告作業の自動化と、入力の分散化。
**ターゲット**: 4〜5会場の会場責任者 + 本部

#### 機能要件 (Must Have)
1.  **公式帳票出力 (PDF/Excel)**:
    *   埼玉新聞、TV埼玉など提出先ごとの**「完全なフォーマット」での出力**。
    *   これが無いと結局手作業で転記が発生するため、業務効率化の本丸。
2.  **分散入力対応**:
    *   各会場の担当者がスマホ/タブレットで「自会場の試合のみ」入力。
    *   結果承認フロー（会場入力 → 本部承認）。
3.  **日程調整アシスト**:
    *   自動生成まではしないが、「対戦禁止カード」が含まれていないかチェックするバリデーション機能。
4.  **決勝Tマッチング**:
    *   予選順位に基づき、決勝トーナメントの枠を自動埋めする（手動修正可）。

#### 非機能要件
*   **Role**: Admin / Venue Manager の権限分離。
*   **UI**: モバイルファースト（タブレット操作への最適化）。

---

### Phase 3: MAX - The "Engagement Platform" (大会プラットフォーム)
**コンセプト**: 選手・保護者・ファンへの価値提供と、システムとしての強靭化。
**ターゲット**: 全参加者、保護者、ファン

#### 機能要件 (Must Have)
1.  **パブリックビューイング**:
    *   ログイン不要の閲覧専用サイト。
    *   スマホで保護者が「今、どこの学校が勝っているか」をリアルタイム確認。
2.  **詳細スタッツ (Granularity)**:
    *   「スコア(2-1)」だけでなく、「誰が、いつ決めたか」の記録。
    *   得点ランキングの自動生成。
3.  **オフライン対応 (PWA)**:
    *   電波の悪いグラウンドでも入力可能にし、オンライン復帰時にSync。
    *   ネイティブアプリに近い操作感。
4.  **大会アーカイブ**:
    *   「2024年度」「2025年度」と年度を跨いでデータを蓄積・閲覧可能にする。

#### 非機能要件
*   **Scale**: 数百〜数千PVに耐えうる構成（CDN等の活用）。
*   **Resilience**: ネットワーク切断時のデータ保護。

---

## 3. 技術スタック推奨 (Technical Direction)

MAXフェーズの要件（PWA、パブリックビュー、詳細スタッツ）を見据えると、**FastAPI + React (Vite)** の構成が最適である。

*   **Frontend**: React + Tailwind (レスポンシブ、PWA化が容易、UIコンポーネントの再利用)
*   **Backend**: FastAPI (型安全性、非同期処理、高速なAPI)
*   **Database**: SQLite (Small Start) -> PostgreSQL (Scaling for MAX/Archive)
*   **Reporting**: ReportLab/WeasyPrint (PythonでのPDF生成に長がある)

**結論**: 現在作成中の `d:\UrawaCup\src` (Claude Code生成版) のアーキテクチャを採用し、MINI要件から順に実装を固めていくべきである。
