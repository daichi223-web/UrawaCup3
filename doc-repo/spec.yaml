_meta:
  created_at: "2026-01-05"
  description: "浦和カップ トーナメント管理システム 仕様書"
  version: "1.0.0"

# プロジェクト構造
project:
  name: "urawacup"
  structure:
    backend:
      framework: FastAPI
      orm: SQLAlchemy
      database: SQLite
      directories:
        - src/backend/main.py
        - src/backend/database.py
        - src/backend/models/
        - src/backend/routes/
        - src/backend/schemas/
        - src/backend/services/
        - src/backend/utils/
    frontend:
      framework: React
      bundler: Vite
      language: TypeScript
      styling: TailwindCSS
      directories:
        - src/frontend/src/
        - src/frontend/src/components/
        - src/frontend/src/pages/
        - src/frontend/src/store/
        - src/frontend/src/hooks/
        - src/frontend/src/api/

# データモデル
models:
  Tournament:
    table: tournaments
    fields:
      id: INTEGER PRIMARY KEY
      name: VARCHAR(200)
      edition: INTEGER
      year: INTEGER
      start_date: DATE
      end_date: DATE
      match_duration: INTEGER DEFAULT 50
      half_duration: INTEGER DEFAULT 25
      interval_minutes: INTEGER DEFAULT 15

  Group:
    table: groups
    fields:
      id: VARCHAR(1) PRIMARY KEY
      tournament_id: INTEGER FK
      name: VARCHAR(50)
      venue_id: INTEGER FK

  Team:
    table: teams
    fields:
      id: INTEGER PRIMARY KEY
      tournament_id: INTEGER FK
      group_id: VARCHAR(1) FK
      name: VARCHAR(100)
      short_name: VARCHAR(20)
      prefecture: VARCHAR(20)
      team_type: ENUM(local, invited)
      is_host: BOOLEAN
      group_order: INTEGER

  Player:
    table: players
    fields:
      id: INTEGER PRIMARY KEY
      team_id: INTEGER FK
      number: INTEGER
      name: VARCHAR(50)
      name_kana: VARCHAR(100)
      grade: INTEGER
      position: VARCHAR(10)
      is_captain: BOOLEAN

  Match:
    table: matches
    fields:
      id: INTEGER PRIMARY KEY
      tournament_id: INTEGER FK
      group_id: VARCHAR(1)
      venue_id: INTEGER FK
      home_team_id: INTEGER FK
      away_team_id: INTEGER FK
      match_date: DATE
      match_time: TIME
      stage: ENUM(preliminary, semifinal, third_place, final, training)
      status: ENUM(scheduled, in_progress, completed, cancelled)
      home_score_half1: INTEGER
      home_score_half2: INTEGER
      home_score_total: INTEGER
      away_score_half1: INTEGER
      away_score_half2: INTEGER
      away_score_total: INTEGER

  Standing:
    table: standings
    fields:
      id: INTEGER PRIMARY KEY
      tournament_id: INTEGER FK
      group_id: VARCHAR(1)
      team_id: INTEGER FK
      rank: INTEGER
      played: INTEGER
      won: INTEGER
      drawn: INTEGER
      lost: INTEGER
      goals_for: INTEGER
      goals_against: INTEGER
      goal_difference: INTEGER
      points: INTEGER

  Venue:
    table: venues
    fields:
      id: INTEGER PRIMARY KEY
      tournament_id: INTEGER FK
      name: VARCHAR(100)
      short_name: VARCHAR(20)
      address: VARCHAR(200)
      max_matches_per_day: INTEGER DEFAULT 6
      is_final_venue: BOOLEAN DEFAULT FALSE

  Goal:
    table: goals
    fields:
      id: INTEGER PRIMARY KEY
      match_id: INTEGER FK
      team_id: INTEGER FK
      player_id: INTEGER FK NULLABLE
      scorer_name: VARCHAR(50)
      minute: INTEGER
      half: INTEGER
      is_own_goal: BOOLEAN DEFAULT FALSE
      is_penalty: BOOLEAN DEFAULT FALSE

  User:
    table: users
    fields:
      id: INTEGER PRIMARY KEY
      username: VARCHAR(50) UNIQUE
      password_hash: VARCHAR(255)
      display_name: VARCHAR(50)
      role: ENUM(admin, venue_staff, viewer)
      venue_id: INTEGER FK NULLABLE
      is_active: BOOLEAN DEFAULT TRUE

  ExclusionPair:
    table: exclusion_pairs
    fields:
      id: INTEGER PRIMARY KEY
      tournament_id: INTEGER FK
      group_id: VARCHAR(1)
      team1_id: INTEGER FK
      team2_id: INTEGER FK
      reason: VARCHAR(200)

  Staff:
    table: staff
    fields:
      id: INTEGER PRIMARY KEY
      team_id: INTEGER FK
      name: VARCHAR(50)
      role: ENUM(manager, coach, accompanying_referee)
      phone: VARCHAR(20)

  TeamUniform:
    table: team_uniforms
    fields:
      id: INTEGER PRIMARY KEY
      team_id: INTEGER FK
      uniform_type: ENUM(fp_main, fp_sub, gk_main, gk_sub)
      shirt_color: VARCHAR(30)
      pants_color: VARCHAR(30)
      socks_color: VARCHAR(30)

# API仕様
api:
  auth:
    - POST /api/auth/login
    - POST /api/auth/logout
    - GET /api/auth/me
    - POST /api/auth/refresh

  tournaments:
    - GET /api/tournaments
    - POST /api/tournaments
    - GET /api/tournaments/{id}
    - PUT /api/tournaments/{id}
    - DELETE /api/tournaments/{id}

  teams:
    - GET /api/teams
    - POST /api/teams
    - GET /api/teams/{id}
    - PUT /api/teams/{id}
    - DELETE /api/teams/{id}
    - POST /api/teams/import-csv

  matches:
    - GET /api/matches
    - GET /api/matches/{id}
    - PUT /api/matches/{id}/score
    - POST /api/matches/{id}/lock
    - DELETE /api/matches/{id}/lock
    - POST /api/matches/generate-schedule/{tournament_id}
    - POST /api/matches/generate-finals/{tournament_id}

  standings:
    - GET /api/standings
    - POST /api/standings/recalculate/{tournament_id}

# 決定事項
decisions: {}
